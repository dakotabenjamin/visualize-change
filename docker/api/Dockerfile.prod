FROM node:carbon-alpine

WORKDIR /app
COPY api .

RUN yarn global add wait-on

ENV NODE_ENV=production
RUN yarn install

EXPOSE 4000

CMD wait-on -l tcp:db:27017 tcp:rabbitmq:5672 && yarn start
